language: php
php:
- '7.1'

services:
- docker

before_install:
# install heroku CLI
#- wget -qO- https://toolbelt.heroku.com/install.sh | sh
# login to heroku registries
- docker login --username=_ --password=${HEROKU_TOKEN} registry.heroku.com
#- echo "$HEROKU_PASSWORD" | docker login -u "$HEROKU_USERNAME" --password-stdin registry.heroku.com
- docker build -t cotodo/cotodo .
- docker tag cotodo/cotodo registry.heroku.com/$HEROKU_APP_NAME/web

install:
- composer install

addons:
  sonarcloud:
    organization: cotodo

script:
- "./bin/phpunit --verbose"
- sonar-scanner

deploy:
  provider: script
  script: 
    - docker push registry.heroku.com/$HEROKU_APP_NAME/web
#  on: dev
  on:
    all_branches: true


